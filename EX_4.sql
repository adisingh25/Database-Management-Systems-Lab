USE DBMS_LAB;
SHOW TABLES;


CREATE TABLE BRANCH 
(
	BCODE VARCHAR(3) PRIMARY KEY,
    NAME VARCHAR(10) NOT NULL
);


INSERT INTO BRANCH VALUES ('B1', 'BRANCH1');
INSERT INTO BRANCH VALUES ('B2', 'BRANCH2');
INSERT INTO BRANCH VALUES ('B3', 'BRANCH3');
INSERT INTO BRANCH VALUES ('B4', 'BRANCH4');
INSERT INTO BRANCH VALUES ('B5', 'BRANCH5');

SELECT * FROM BRANCH;


CREATE TABLE CUSTOMER 
(
	CCODE INT PRIMARY KEY,
    NAME VARCHAR(10) NOT NULL
    );
    
INSERT INTO CUSTOMER VALUES (1, 'C1');
INSERT INTO CUSTOMER VALUES (2, 'C2');
INSERT INTO CUSTOMER VALUES (3, 'C3');
INSERT INTO CUSTOMER VALUES (4, 'C4');
INSERT INTO CUSTOMER VALUES (5, 'C5');

SELECT * FROM CUSTOMER;


CREATE TABLE ACCOUNT 
(
	BCODE VARCHAR(3),
    CCODE INT,
    ACODE VARCHAR(3) UNIQUE,
    TYPE VARCHAR(10),
    PRIMARY KEY(BCODE,CCODE,ACODE,TYPE),
    foreign key (BCODE) REFERENCES BRANCH(BCODE) ON DELETE CASCADE,
    FOREIGN KEY (CCODE) REFERENCES CUSTOMER(CCODE) ON DELETE CASCADE
);

DROP TABLE ACCOUNT;

INSERT INTO ACCOUNT VALUES ('B1', 1, 'A1', 'SAVINGS');
INSERT INTO ACCOUNT VALUES ('B1', 1, 'A2', 'CURRENT');
INSERT INTO ACCOUNT VALUES ('B2', 2, 'A3', 'SAVINGS');
INSERT INTO ACCOUNT VALUES ('B2', 2, 'A4', 'CURRENT');
INSERT INTO ACCOUNT VALUES ('B3', 3, 'A5', 'SAVINGS');
INSERT INTO ACCOUNT VALUES ('B4', 4, 'A6', 'CURRENT');
INSERT INTO ACCOUNT VALUES ('B5', 5, 'A7', 'SAVINGS');

SELECT * FROM ACCOUNT;


CREATE TABLE TRANSACTION 
(
	CCODE INT,
    ACODE VARCHAR(3),
    TYPE VARCHAR(10),
    AMOUNT INT,
    FOREIGN KEY (CCODE) REFERENCES CUSTOMER(CCODE),
    FOREIGN KEY (ACODE) REFERENCES ACCOUNT(ACODE)
    );
    
    
    
INSERT INTO TRANSACTION VALUES ( 1, 'A1', 'WITHDRAWL', 2000);
INSERT INTO TRANSACTION VALUES ( 1, 'A1', 'DEPOSIT', 3000);
INSERT INTO TRANSACTION VALUES ( 1, 'A1', 'WITHDRAWL', 4000);
INSERT INTO TRANSACTION VALUES ( 2, 'A4', 'DEPOSIT', 5000);
INSERT INTO TRANSACTION VALUES ( 3, 'A5', 'WITHDRAWL', 6000);


SELECT * FROM TRANSACTION;    




-- SELECT * 
-- FROM CUSTOMER
-- WHERE CCODE IN (
-- 	SELECT CCODE 
--     FROM ACCOUNT 
--     WHERE TYPE='SAVINGS' 
-- 								-- INTERSECT
--     SELECT CCODE 
--     FROM ACCOUNT 
--     WHERE TYPE='CURRENT'
-- );


SELECT B.BCODE, B.NAME , COUNT(A.ACODE) AS NO_OF_ACCOUNTS
FROM BRANCH B, ACCOUNT A 
WHERE B.BCODE = A.BCODE
GROUP BY B.BCODE,B.NAME;


SELECT C.CCODE, C.NAME FROM
CUSTOMER C, TRANSACTION T
WHERE C.CCODE = T.CCODE
GROUP BY C.CCODE, C.NAME
HAVING COUNT(C.CCODE) >=3;


SELECT * 
FROM BRANCH
WHERE BCODE IN (
SELECT BCODE 
FROM ACCOUNT
GROUP BY(BCODE)
HAVING COUNT(BCODE) < (
(SELECT COUNT(*) FROM ACCOUNT)
/
(SELECT COUNT(*) FROM BRANCH)
));


